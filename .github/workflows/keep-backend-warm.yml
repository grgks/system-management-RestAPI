name: Keep Backend Warm

on:
  schedule:
    # Runs every 10 minutes
    - cron: '*/10 * * * *'

  # Allow manual trigger from GitHub UI
  workflow_dispatch:

jobs:
  ping-backend:
    runs-on: ubuntu-latest

    steps:
      - name: Ping Backend
        run: |
          echo "Pinging backend to keep it warm..."
          echo "Timestamp: $(date '+%Y-%m-%d %H:%M:%S UTC')"
          echo ""
          
          # Ping the auth endpoint
          # Expected: 405 Method Not Allowed (because it's POST only)
          # But that's OK - it wakes up the backend!
          response=$(curl -s -o /dev/null -w "%{http_code}" \
            --max-time 60 \
            https://system-management-restapi.onrender.com)
          
          echo "Response code: $response"
          
          if [ $response -eq 405 ]; then
            echo " Backend is warm! (405 = Method Not Allowed, as expected)"
          elif [ $response -ge 200 ] && [ $response -lt 500 ]; then
            echo " Backend responded with code: $response"
          else
            echo " ! Unexpected response: $response"
          fi
          
          echo ""
          echo "=================================="
          echo "Keep-alive completed"
          echo "Backend will stay warm for 15 minutes"
          echo "Next ping in 10 minutes"
          echo "=================================="